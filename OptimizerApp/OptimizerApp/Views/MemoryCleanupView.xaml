<UserControl x:Class="OptimizerApp.Views.MemoryCleanupView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="900">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Title -->
            <TextBlock Text="Monitoreo y Limpieza de Memoria" FontSize="20" FontWeight="SemiBold" Foreground="{StaticResource RazerTextPrimaryBrush}" />

            <!-- Status and Controls -->
            <Grid Grid.Row="1" Margin="0,16,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Status Info -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{Binding StatusMessage}" Style="{StaticResource RazerStatusStyle}" FontSize="12" />
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <TextBlock Text="{Binding CurrentStats.RamUsagePercent, StringFormat=RAM: {0}%}" Margin="0,0,16,0" />
                        <TextBlock Text="{Binding CurrentStats.RamUsedGb, StringFormat='{}{0} GB / '}" />
                        <TextBlock Text="{Binding CurrentStats.RamTotalGb, StringFormat='{}{0} GB'}" />
                        <Separator Margin="16,0,16,0" />
                        <TextBlock Text="{Binding CurrentStats.CpuUsagePercent, StringFormat=CPU: {0}%}" />
                    </StackPanel>
                    <TextBlock Text="{Binding CurrentStats.ChromeProcessCount, StringFormat='Chrome: {0} procesos, '}" 
                               Foreground="{StaticResource AccentHighlightBrush}" Visibility="{Binding HasChrome, Converter={StaticResource BoolToVisibilityConverter}}"
                               Margin="0,8,0,0" />
                    <TextBlock Text="{Binding CurrentStats.ChromeRamGb, StringFormat='{}{0} GB'}" 
                               Foreground="{StaticResource AccentHighlightBrush}" Visibility="{Binding HasChrome, Converter={StaticResource BoolToVisibilityConverter}}" />
                </StackPanel>

                <!-- Control Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <StackPanel.Resources>
                        <Style TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
                            <Setter Property="Margin" Value="0,0,8,0" />
                            <Setter Property="Padding" Value="12,8" />
                            <Setter Property="MinWidth" Value="100" />
                        </Style>
                    </StackPanel.Resources>
                    <Button Content="Refrescar" Command="{Binding RefreshCommand}" IsEnabled="{Binding IsLoading, Converter={StaticResource BoolInverterConverter}}" />
                    <Button Content="Top RAM" Command="{Binding CleanTopRamCommand}" />
                    <Button Content="Limpiar Memoria" Command="{Binding CleanAllCommand}" IsEnabled="{Binding IsLoading, Converter={StaticResource BoolInverterConverter}}" />
                    <Button Content="Limpiar Temp" Command="{Binding CleanTempFilesCommand}" IsEnabled="{Binding IsLoading, Converter={StaticResource BoolInverterConverter}}" />
                </StackPanel>
            </Grid>

            <!-- Cleanup Results -->
            <Border Grid.Row="2" Style="{StaticResource RazerBorderStyle}" Margin="0,0,0,12"
                    Visibility="{Binding HasCleanupResults, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel>
                    <TextBlock Text="Resultados de Limpieza" FontWeight="SemiBold" Margin="0,0,0,8" Style="{StaticResource RazerSubtitleStyle}" />
                    <TextBlock Text="{Binding CleanupSummary}" TextWrapping="Wrap" Foreground="{StaticResource AccentHighlightBrush}" />
                </StackPanel>
            </Border>

            <!-- Processes Tabs -->
            <TabControl Grid.Row="3" Margin="0,0,0,0" MinHeight="300">
                <!-- Top RAM Processes -->
                <TabItem Header="Top Procesos por RAM" IsSelected="True">
                    <DataGrid ItemsSource="{Binding TopRamProcesses}" 
                              IsReadOnly="True" 
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Margin="8">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Proceso" Binding="{Binding Name}" Width="*" />
                            <DataGridTextColumn Header="PID" Binding="{Binding ProcessId}" Width="60" />
                            <DataGridTextColumn Header="RAM (MB)" Binding="{Binding MemoryMb, StringFormat='{}{0:N2}'}" Width="100" />
                            <DataGridTextColumn Header="CPU (%)" Binding="{Binding CpuPercent, StringFormat='{}{0:N2}'}" Width="80" />
                        </DataGrid.Columns>
                    </DataGrid>
                </TabItem>

                <!-- Top CPU Processes -->
                <TabItem Header="Top Procesos por CPU">
                    <DataGrid ItemsSource="{Binding TopCpuProcesses}" 
                              IsReadOnly="True" 
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Margin="8">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Proceso" Binding="{Binding Name}" Width="*" />
                            <DataGridTextColumn Header="PID" Binding="{Binding ProcessId}" Width="60" />
                            <DataGridTextColumn Header="CPU (s)" Binding="{Binding CpuPercent, StringFormat='{}{0:N2}'}" Width="100" />
                            <DataGridTextColumn Header="RAM (MB)" Binding="{Binding MemoryMb, StringFormat='{}{0:N2}'}" Width="100" />
                        </DataGrid.Columns>
                    </DataGrid>
                </TabItem>

                <!-- Chrome Processes -->
                <TabItem Header="Procesos Chrome" Visibility="{Binding HasChrome, Converter={StaticResource BoolToVisibilityConverter}}">
                    <DataGrid ItemsSource="{Binding ChromeProcesses}" 
                              IsReadOnly="True" 
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Margin="8">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Proceso" Binding="{Binding Name}" Width="*" />
                            <DataGridTextColumn Header="PID" Binding="{Binding ProcessId}" Width="60" />
                            <DataGridTextColumn Header="RAM (MB)" Binding="{Binding MemoryMb, StringFormat='{}{0:N2}'}" Width="100" />
                            <DataGridTextColumn Header="CPU (s)" Binding="{Binding CpuPercent, StringFormat='{}{0:N2}'}" Width="100" />
                        </DataGrid.Columns>
                    </DataGrid>
                </TabItem>
            </TabControl>
        </Grid>
    </ScrollViewer>
</UserControl>

